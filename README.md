# ABOUT
The goal of this project was to estimate discretionary income around the world. Discretionary income is defined as post tax income left over after accounting for basic expenses: like housing, food, transportation, and healthcare. I have, for now, shelved this project due to: the  complexity of the problem being much larger than I had forseen, less international data being availible for things like rent than I had expected, and a significant SQL mistake resulting in the database needing repair. Overall, it seemed the longer I worked on the project that things seemed more and more difficult, that my final results would be less and less widely applicable, intereptable, and rigorous than I had initially hoped. So I have decided to stop work on this project to work on one I that I may be more passionate about. This readme exists to document things that are in the repo, steps I took in this project, what I have learned from working this project, and what I would do differently were I to do a project like this in the future.
# WHAT'S IN THIS REPO
-This README
-The original tables collected during the data gathering phase
-A backup of the SQL database I was working with during this project
-Various Jupyter Notebooks that I used to transform the original tables and then import them to the postgresql database
-A Python file defining a function to calculate taxes and social security contributions (untested)
# WHAT HAVE I LEARNED?
-Looking for data needed for a project
-Working with data that often doesn't fit well together (different names for same country, data describing different timeframs, etc)
-Cleaning and transforming tables to a more workable form in SQL
-Using sqlalchemy to send pandas dataframes to postgresql databases
# WHAT WOULD I HAVE DONE DIFFERENTLY
-Backup whatever I plan to work on to github before working on it
-Check for data availibility before setting project expectations
-Use sqlite as opposed to something like postgresql
-Break down the project into subprojects before starting (Do you still want to do this? Or is just the rent, tax, or income portion enough to be their own project?)

# DETAILS
## DATA COLLECTION
I wanted to my project to calculate  discretionary income for various income levels, mean income is often skewed by a few high income earners and I wanted to get a complete picture of how well each country fared for all the people that lived there. I ended up sourcing my income data from the World Income Inequality Database, since they had data about income at 10 income deciles. 
The tax information and social security rates were sourced from the OECD. I needed the information about rates since I wanted to calculate more broadly than just the average income how much someone would tend to have after taxes. 
Information about expenses like food, rent, transportation, and healthcare were sourced from Statista. For some reason I imagined that there would be some big spreadsheet estimating these costs by country would exist somewhere but there wasn't anything like that for any of these categories. The best I could find for food, rent, and transport was a spreadsheet detailing average costs for individual cities around the world. My plan was to take some percent of the mean value of the cities in a country for each of these categories. But the lack of rigor that this method had really discouraged me from completing this project. I also at this point considered the fact that income and expenses are often related together. I was OK with the idea that the expenses would only include urban data since that is what I was personally most interested in and I could make that clear but, for example, income, taxes, and cost of living would all significantly higher somewhere like San Francisco than somewhere like Chicago and my data wouldn't make any distinction. Regardless I continued on and also downloaded a table that contained geographic information. 
The next data problem was finding healthcare data. I was able to find a table with healthcare spending per capita by country but it didn't make any distinction based on where each amount of the spending was coming from. Each country pays for its healthcare in a certain way in some countries it is included in taxes, in others some is included in taxes and some is out of pocket at point of use. In the US, some of health care is tax-subsidized but most of the cost is out of pocket and/or paid by the employer. At this point though I already had some degree of sunk-cost and felt that despite all this I might still be able to derive some useful information from this data.
## DATA CLEANING
I had decided to use a postgresql database to store my data in since it was a popular open source choice relational database tool. After investigating methods to get the CSV data I had collected into postgresql, I decided to use Python's pandas and sqlalchemy modules to import the data first into a pandas Dataframe and make a few changes to each dataset then send each table to the database using sqlalchemy. I made a similar Jupyter Notebook to do these steps for of the CSV files so I could easily check how the Dataframe looked after each step and before exporting to SQL.
### TAX AND SSC DATA
I had decided to do my analysis on 2019 data since that was the year that I was able to find data about expenses and also it was the most recent "normal" year (pre-COVID 19). So I limited the tax data to 2019 and there was already still a problem. On the OECD site that data table was formatted in a nice logical way with each row being a country by year and the various tax thresholds, rates and other information stored in the columns. However, downloading the data threw all this out the window, now each piece of information got it's own row. For example, the first United States tax threshold would have it's own row with columns saying it was a value for the United States in 2019 and that the value was 20000 and the value type was THRESHOLD_00. To correct this, I created a view of the table using the cross tab function that would allow me to take these rows and combine them into a single row with all the information for that year and country. Now there was another problem, the thresholds were in each country's individual currency while my income data was all in USD. I would want all the information in USD any way so I downloaded a table from the US treasury that had weekly exchange rates for each currency in 2019 and found the average and applied that rate to each of the thresholds. These datasets were now ready for use.
### EXPENSE DATA
Since I only had expense data for individual cities, I needed to group them by country. I had downloaded a table containing geographic information for this purpose. But there was a problem, for many cities there were multiple entries in multiple countries. For example, there was a Paris in the United States not just in France. To alleviate this problem I modified my query to only include cities where the city population was the maximum value for cities with that name. This was able to fix the problem and by using group by I got a table for each country that had the median of all the mean values for cities in that country (i.e. say a country has three cities in the database with mean rents of 1000, 1500, and 1700 within each of those cities. The value in my table would be 1500). While I again recognized that this was far from ideal data I still wanted this project to work.
## WHAT MADE ME QUIT THE PROJECT
The next step that I tried to complete was writing a function to apply the various tax rates from my database to each of the incomes in the income dataset. I wrote a function to do just this but I realized that much like everything else in this project that unless I spent 40 hours a week for the next year that it just would not be accurate. Each country has its own unique tax rules and tax deductions much of which weren't actually contained in the OECD tax dataset. I realized this after looking at what information I had about taxes in the US. I knew that there was way more to it than what I had in the database. Many Americans end up paying little to no taxes and there was no way that this would be the case with my current methodology. I had been thinking this whole time that even if I didn't get accurate discretionary income that I would at least be able to get income after taxes for a wide range incomes in each country. But I would need way more information than I had about the lives of each person that the income in my data represented than I actually had, that each country would probably need its own function, and that finding this sort of tax information for non-english speaking countries would be difficult to impossible. Since, I did not think I would be able to reach any sort of reliable conclusion about disposable or discretionary income I lost interest in the project.




